name: Auto Update Forum Project

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]
  schedule:
    # Run every day at 2 AM UTC
    - cron: '0 2 * * *'

jobs:
  update-check:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
      
    - name: Setup PHP
      uses: shivammathur/setup-php@v2
      with:
        php-version: '7.4'
        extensions: pdo, pdo_mysql, json, mbstring, openssl, curl, gd, zip, xml
        
    - name: Install dependencies
      run: |
        composer install --no-dev --optimize-autoloader
        npm install
        
    - name: Run tests
      run: |
        php vendor/bin/phpunit tests/
        
    - name: Build assets
      run: |
        npm run production
        
    - name: Check for updates
      run: |
        echo "Checking for available updates..."
        # Add your update checking logic here
        
    - name: Create release
      if: github.ref == 'refs/heads/main'
      uses: actions/create-release@v1
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      with:
        tag_name: v${{ github.run_number }}
        release_name: Release v${{ github.run_number }}
        body: |
          ## ðŸš€ Automatic Update
          
          This release was automatically generated.
          
          ### Changes:
          - Updated dependencies
          - Security patches
          - Bug fixes
          - Performance improvements
          
          ### Installation:
          1. Download the latest release
          2. Extract to your server
          3. Run `php install.php`
          4. Update your database
        draft: false
        prerelease: false